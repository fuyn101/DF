# 层次分析法 (AHP) MATLAB 函数库

本文件夹包含用于执行层次分析法 (AHP) 的 MATLAB 函数。AHP 是一种结合定性与定量分析的经典多标准决策方法，广泛应用于权重计算和方案评估。

该库提供了两种核心的权重计算方法：特征向量法和方根法。

## 文件说明

-   `AHP_EigenvectorMethod.m`: 使用 **特征向量法** 计算权重。这是 AHP 最精确、最受推荐的方法，它通过计算判断矩阵的最大特征值和对应的特征向量来确定权重。
-   `AHP_RootMethod.m`: 使用 **方根法（也称几何平均法）** 计算权重。这是一种计算相对简单的近似方法，适用于快速估算或一致性较好的矩阵。
-   `DEMO.m`: 一个详细的示例脚本，演示了如何定义判断矩阵、调用上述两种函数、解释结果并进行一致性检验。

## 如何使用

1.  在 MATLAB 中打开 `DEMO.m` 文件。
2.  根据您的具体问题，在脚本的第一部分修改 **判断矩阵 `A`**。
3.  直接运行 `DEMO.m` 脚本。
4.  在 MATLAB 的命令行窗口中查看输出结果，包括两种方法计算的权重、最大特征值、一致性比例(CR)以及一致性检验结果。

## 函数详解

#### `[w, CR, lambda_max] = AHP_EigenvectorMethod(A)`

-   **功能**: 使用特征向量法计算权重和一致性。
-   **输入**:
    -   `A`: 一个 n x n 的正互反判断矩阵。
-   **输出**:
    -   `w`: (n x 1) 的权重向量，已经归一化。
    -   `CR`: 一致性比例 (Consistency Ratio)。**如果 `CR >= 0.1`，则认为判断矩阵的一致性不足，需要重新调整矩阵元素。**
    -   `lambda_max`: 判断矩阵 `A` 的最大特征值。

#### `[w, CR, lambda_max] = AHP_RootMethod(A)`

-   **功能**: 使用方根法计算权重和一致性。
-   **输入**:
    -   `A`: 一个 n x n 的正互反判断矩阵。
-   **输出**:
    -   `w`: (n x 1) 的权重向量，已经归一化。
    -   `CR`: 一致性比例。
    -   `lambda_max`: 判断矩阵 `A` 的最大特征值，用于一致性检验。

## 示例代码 (来自 `DEMO.m`)

```matlab
%% 1. 定义判断矩阵
% 假设有4个指标 C1, C2, C3, C4
A = [1,   1/3, 2,   4;   % C1 与 C1, C2, C3, C4 的比较
     3,   1,   4,   5;   % C2 与 C1, C2, C3, C4 的比较
     1/2, 1/4, 1,   3;   % C3 与 C1, C2, C3, C4 的比较
     1/4, 1/5, 1/3, 1];  % C4 与 C1, C2, C3, C4 的比较

%% 2. 使用特征向量法进行计算
fprintf('--- 1. 特征向量法计算结果 ---\n');
[w_eig, CR_eig, lambda_max] = AHP_EigenvectorMethod(A);
fprintf('最大特征值 λ_max: %.4f\n', lambda_max);
fprintf('权重向量 w:\n');
disp(w_eig');
fprintf('一致性比例 CR: %.4f\n', CR_eig);
if CR_eig < 0.1
    fprintf('结果通过一致性检验 (CR < 0.1)。\n');
else
    fprintf('警告: 未通过一致性检验 (CR >= 0.1)，请检查判断矩阵。\n');
end

%% 3. 使用方根法进行计算
fprintf('\n--- 2. 方根法计算结果 ---\n');
[w_root, CR_root] = AHP_RootMethod(A);
fprintf('权重向量 w:\n');
disp(w_root');
fprintf('一致性比例 CR: %.4f\n', CR_root);
if CR_root < 0.1
    fprintf('结果通过一致性检验 (CR < 0.1)。\n');
else
    fprintf('警告: 未通过一致性检验 (CR >= 0.1)，请检查判断矩阵。\n');
end
```

---

## 附录：关于 RI (平均随机一致性指标)

您可能会好奇代码中的 `RI_table` 是从何而来的。

`RI` 值并不是实时计算的，而是通过大规模蒙特卡洛模拟得出的经验数据。其计算过程如下：

1.  **生成随机矩阵**：对于给定的阶数 `n`，通过计算机生成大量（例如 500 个或更多）的随机正互反矩阵。矩阵中的元素从 {1, 2, ..., 9} 及其倒数中随机抽取。
2.  **计算一致性指标 (CI)**：为每一个随机矩阵计算其最大特征值 `λ_max`，并得到其一致性指标 `CI = (λ_max - n) / (n - 1)`。
3.  **求平均**：将所有随机矩阵的 `CI` 值求算术平均，这个平均值就是该阶数 `n` 的 `RI` 值。

这个过程由 AHP 的创始人完成，并将结果制成标准表格，为我们判断矩阵的一致性提供了一个可靠的基准。
