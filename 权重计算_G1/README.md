# G1 权重计算方法 (序关系分析法) MATLAB 实现

## 1. 概述

本项目提供了 G1 权重计算方法的 MATLAB 实现。G1 法是一种主观赋权法，它通过专家对指标进行重要性排序，并给出相邻指标的相对重要性比值，从而确定各指标的权重。该方法避免了构造判断矩阵和进行一致性检验的复杂过程，操作简单，易于理解。

该实现将核心计算逻辑封装在 `calculateG1Weights.m` 函数中，并提供了一个清晰的调用示例 `run_G1_example.m`，方便用户快速上手。

## 2. 文件结构

```
G1/
├── calculateG1Weights.m   # 核心权重计算函数
├── run_G1_example.m       # 调用示例脚本
├── G1OPT.m                # 原始的脚本文件 (备份)
└── README.md              # 说明文档 (当前文件)
```

- **`calculateG1Weights.m`**: 这是一个封装好的 MATLAB 函数，接收指标的重要性排序和相邻指标的相对重要性比值作为输入，输出计算得到的最终权重。
- **`run_G1_example.m`**: 这是一个演示如何使用 `calculateG1Weights.m` 的示例脚本。用户可以修改此文件中的参数来满足自己的需求。
- **`G1OPT.m`**: 这是您提供的原始脚本，已作为备份保留。
- **`README.md`**: 本说明文档。

## 3. G1 方法原理简介

G1 法的核心思想如下：

1.  **确定指标序关系**：由决策者或专家根据经验，对 `n` 个评价指标的重要性进行排序，得到一个关系序列：
    `x_1 > x_2 > ... > x_n`
    （这里 `x_i` 代表第 `i` 重要的指标，注意不是指标的原始编号）。

2.  **确定相邻指标的相对重要性**：决策者判断相邻指标 `x_{k-1}` 和 `x_k` 之间的重要性比值 `r_k`，即：
    `r_k = w_{k-1} / w_k`  (k = n, n-1, ..., 2)
    其中 `w_k` 是第 `k` 重要指标的权重。`r_k` 的建议取值如下：
    - `1.0`: `x_{k-1}` 和 `x_k` 同等重要
    - `1.2`: `x_{k-1}` 比 `x_k` 稍微重要
    - `1.4`: `x_{k-1}` 比 `x_k` 明显重要
    - `1.6`: `x_{k-1}` 比 `x_k` 非常重要
    - `1.8`: `x_{k-1}` 比 `x_k` 极端重要

3.  **计算权重**：基于上述关系和权重归一化条件 (`sum(w_i) = 1`)，可以推导出每个指标的权重。本代码实现了这一计算过程。其核心推导如下：
    -   根据 `r_k = w_{k-1} / w_k`，所有权重 `w_k` 都可以用最不重要的权重 `w_n` 来表示。
    -   利用 `sum(w_k) = 1` 的约束，可以解出 `w_n = 1 / sum(ratios)`，其中 `ratios` 是每个权重相对于 `w_n` 的比值向量。
    -   最后，通过 `w_{k-1} = r_k * w_k` 反向递推出所有权重。
    
    *我们已对核心计算代码进行重构，使其逻辑更贴近数学推导，更易于理解和验证。*

## 4. 使用方法

1.  **准备工作**：确保 `calculateG1Weights.m` 和 `run_G1_example.m` 在同一个文件夹内，或者 `calculateG1Weights.m` 所在的文件夹已经被添加到 MATLAB 的搜索路径中。

2.  **修改参数**：打开 `run_G1_example.m` 文件。
    -   修改 `p_relationship` 向量：根据您的指标体系，定义指标的重要性排序。例如，`[3, 1, 2]` 表示指标3最重要，其次是指标1，最后是指标2。
    -   修改 `p_relative` 向量：根据排序结果，定义相邻指标的重要性比值。该向量的长度必须是指标数量减一。例如，对于 `[3, 1, 2]` 的排序，`p_relative` 应该包含两个值，分别代表 `w_3/w_1` 和 `w_1/w_2` 的比值。

3.  **运行脚本**：
    -   在 MATLAB 编辑器中打开 `run_G1_example.m`，按 `F5` 键运行。
    -   或者在 MATLAB 命令行窗口中，切换到该文件所在目录，然后输入 `run_G1_example` 并按回车。

4.  **查看结果**：
    运行结束后，计算结果将直接显示在 MATLAB 的命令行窗口中，包括：
    -   按重要性排序后的权重 (`p_weight_sorted`)
    -   映射回原始指标顺序的最终权重 (`p_final_weights`)
    -   所有权重之和（用于验证，应约等于1）

## 5. 函数 `calculateG1Weights` 详解

```matlab
function [p_final_weights, p_weight_sorted] = calculateG1Weights(p_relationship, p_relative)
```

-   **输入参数**:
    -   `p_relationship` (`1xN` 向量): 定义 `N` 个指标的重要性排序。
    -   `p_relative` (`1x(N-1)` 向量): 定义排序后，相邻指标的重要性比值。

-   **输出参数**:
    -   `p_final_weights` (`1xN` 向量): 返回与原始指标顺序对应的最终权重。例如 `p_final_weights(1)` 是指标1的权重。
    -   `p_weight_sorted` (`1xN` 向量): 返回按重要性排序的权重。

---
*代码由 Cline (AI Software Engineer) 重构于 2025/07/18*
